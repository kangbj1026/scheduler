# 서버 설정
server:
  port: 8081  # 스프링 부트 서버 포트 설정 (기본 8080 → 8081)

# 스프링 관련 설정
spring:
  application:
    name: SchedulerJava
  profiles:
      active: ${SPRING_PROFILES_ACTIVE}  # 기본값
  config:
    import: "optional:classpath:env.yml"

  datasource:
    # MySQL 데이터베이스 연결 정보
    url: ${DB_URL}        # 외부 환경 변수 참조
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver  # MySQL 드라이버 클래스

  jpa:
    hibernate:
      ddl-auto: update            # 엔티티 기반 테이블 자동 생성/업데이트
    show-sql: false               # Hibernate SQL 출력 여부 (true면 SQL 로그 콘솔 출력)
    properties:
      hibernate:
        format_sql: false          # SQL 출력 시 보기 좋게 포맷팅
        dialect: org.hibernate.dialect.MySQL8Dialect

  quartz:
    # -------------------------------------------------------
    # ★ 스케줄러 저장 방식 선택
    #   memory → RAMJobStore (DB 안씀, 단일 서버)
    #   jdbc   → JDBCJobStore (DB 사용, 클러스터 가능)
    # -------------------------------------------------------
    job-store-type: memory           # ← 기본은 메모리 방식
    jdbc:
      initialize-schema: never      # Quartz 테이블 자동 생성 옵션
                                    # never    : 어떤 DB에서도 절대 자동 생성하지 않음 (운영 환경 권장)
                                    # embedded : H2/HSQL/Derby 같은 내장 DB에서만 자동 생성 (개발 테스트용)
                                    # always   : 어떤 DB이든 실행 시마다 자동 생성 (초기 개발 단계에서만 사용할 것 — 주의!)
    properties:
      org:
        quartz:
          scheduler:
            # -------------------------------------------------------
            # ★ 스케줄러 이름
            # LocalScheduler       → 로컬/단일 서버용
            # MyClusteredScheduler → 클러스터 서버용
            # -------------------------------------------------------
            instanceName: LocalScheduler
            instanceId: AUTO                     # AUTO: 노드마다 고유 ID 자동 생성
          # ===========================================================
          # ① RAMJobStore (메모리 방식, 단일 서버용)
          #    · DB 테이블 필요 없음
          #    · 서버 재시작 시 스케줄 초기화
          #    · 개발/테스트 환경에 적합
          # -----------------------------------------------------------
          jobStore:
            class: org.quartz.simpl.RAMJobStore        # ★ 메모리 저장 방식
          # ===========================================================
          # ② JDBCJobStore (DB 저장 방식, 클러스터 환경용)
          #    · 아래 블록 전체를 사용하려면 위 RAMJobStore 블록을 주석 처리해야 함
          #    · 여러 서버에서 스케줄 공유 가능
          #    · 스케줄이 서버 재시작해도 유지됨
          # -----------------------------------------------------------
#          jobStore:
#            class: org.quartz.impl.jdbcjobstore.JobStoreTX    # ★ DB 저장 방식
#            driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate  # DB 드라이버 위임
#            useProperties: false                # 직렬화 방식
#            tablePrefix: scheduler_             # quartz 테이블 접두어(prefix)
#            isClustered: true                   # ★ 클러스터링 활성화
#            clusterCheckinInterval: 20000       # 클러스터 노드 체크 주기 (20초)
          # ===========================================================
  sql:
    init:
      # SQL 초기화 모드 설정
      # 'always' : 애플리케이션이 시작될 때 항상 schema.sql data.sql 실행
      # 'embedded' : H2, HSQLDB, Derby 같은 내장 DB 실행
      # 'never' : SQL 초기화 실행하지 않음
      mode: always

logging:
  level:
    org.hibernate.SQL: OFF               # SQL 쿼리
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE  # ? 파라미터 값
    org.quartz: WARN   # Quartz 로그 레벨을 WARN 이상으로 올림
    org.springframework.security: WARN
